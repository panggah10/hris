<?php
include '../template/header.php'; 
include '../template/sidebar.php'; 
include '../connection.php';  

// Function to retrieve data from a table
function getData($table) {
    global $conn; // Use the global connection variable
    $result = $conn->query("SELECT * FROM `$table`");
    if ($result) {
        return $result->fetch_all(MYSQLI_ASSOC);
    } else {
        return []; // Return an empty array if there's an error
    }
}

// Fetch data from phk table
$phk_data = getData('phk');

?>

<main id="main" class="main">
    <div class="container">
        <h1>Manajemen PHK Pegawai</h1>

        <h2>Tambah Data PHK</h2>
        <form method="post" action="submit_phk.php">
            <div class="mb-3">
                <label for="id_karyawan" class="form-label">ID Karyawan</label>
                <input type="number" class="form-control" id="id_karyawan" name="id_karyawan" required>
            </div>
            <div class="mb-3">
                <label for="tanggal_phk" class="form-label">Tanggal PHK</label>
                <input type="date" class="form-control" id="tanggal_phk" name="tanggal_phk" required>
            </div>
            <div class="mb-3">
                <label for="alasan_phk" class="form-label">Alasan PHK</label>
                <textarea class="form-control" id="alasan_phk" name="alasan_phk" rows="3" required></textarea>
            </div>
            <div class="mb-3">
                <label for="status_kompensasi" class="form-label">Status Kompensasi</label>
                <select class="form-select" id="status_kompensasi" name="status_kompensasi" required>
                    <option value="Diberikan">Diberikan</option>
                    <option value="Belum Diberikan">Belum Diberikan</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="jumlah_kompensasi" class="form-label">Jumlah Kompensasi</label>
                <input type="text" class="form-control" id="jumlah_kompensasi" name="jumlah_kompensasi" required>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>

        <h2 class="mt-4">Daftar PHK Pegawai</h2>
        <table class="table">
            <thead>
                <tr>
                    <th>ID PHK</th>
                    <th>ID Karyawan</th>
                    <th>Tanggal PHK</th>
                    <th>Alasan PHK</th>
                    <th>Status Kompensasi</th>
                    <th>Jumlah Kompensasi</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($phk_data as $row): ?>
                    <tr>
                        <td><?= $row['id_phk'] ?></td>
                        <td><?= $row['id_karyawan'] ?></td>
                        <td><?= $row['tanggal_phk'] ?></td>
                        <td><?= $row['alasan_phk'] ?></td>
                        <td><?= $row['status_kompensasi'] ?></td>
                        <td><?= $row['jumlah_kompensasi'] ?></td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
</main><!-- End #main -->

<!-- Add CSS for transition -->
<style>
    .table {
        margin-top: 20px;
    }
</style>

<?php include '../template/footer.php'; ?>
